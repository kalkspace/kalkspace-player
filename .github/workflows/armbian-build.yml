name: Build Armbian

on: push

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1
      - name: checkout armbian build
        run: git clone https://github.com/armbian/build
      - name: prepare patches
        run: cp -a userpatches build/userpatches
      - name: build image
        run: (cd build && ./compile.sh docker BOARD=khadas-vim3 BRANCH=current RELEASE=jammy BUILD_MINIMAL=yes BUILD_DESKTOP=no KERNEL_ONLY=no KERNEL_CONFIGURE=no COMPRESS_OUTPUTIMAGE=sha,gpg,img)
